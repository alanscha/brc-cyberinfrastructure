Bootstrap: docker
From: rocker/rstudio

%post

        mkdir -p /global/scratch
        mkdir -p /global/home/users

%environment

# use rserver to start service rather than /init as in Rocker Dockerfile
# if use /init, the service wants to write to /var/run, which is not possible
# without a writable image and changing ownership of /var so user can write to it

# this runscript by default doesn't require authentication but still
# allows one to use
# PASSWORD=foo singularity run /path/to/file.img --auth-pam-helper-path /usr/lib/rstudio-server/bin/pam-helper --auth-none 0

%runscript
    /usr/lib/rstudio-server/bin/rserver "$@"

# can't get instance.start to work either with or without authentication
%startscript
    /usr/lib/rstudio-server/bin/rserver


